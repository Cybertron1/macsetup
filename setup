#!/bin/bash

set -e

cat /Library/Preferences/com.apple.TimeMachine.plist &>/dev/null || (echo "enable full disk access in the preferences for the Terminal" && exit 1)
sqlite3  /Library/Application\ Support/com.apple.TCC/TCC.db 'SELECT * from access' | grep kTCCServiceAccessibility | grep com.apple.Terminal | grep \|0\|1\|1 &>/dev/null || (echo "enable Accessibility access in preferences for the Terminal" && exit 1)
for f in ./**/*
do
  sudo chmod +x "$f"
done

find ~ ! -name .Trash ! -name .CFUserTextEncoding ! -name .DS_Store -name '.*' -maxdepth 1 -delete

killall "System Preferences" || true

./installs/install
./configures/mac
