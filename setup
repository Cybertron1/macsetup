#!/bin/bash

set -e

cat /Library/Preferences/com.apple.TimeMachine.plist &>/dev/null || (echo "enable full disk access in the preferences for the Terminal" && exit 1)
sqlite3  /Library/Application\ Support/com.apple.TCC/TCC.db 'SELECT * from access' | grep kTCCServiceAccessibility | grep com.apple.Terminal | grep \|0\|1\|1 || (echo "enable Accessibility access in preferences for the Terminal" && exit 1)
for f in ./**/*
do
  sudo chmod +x "$f"
done
find ~ ! -name .Trash ! -name .CFUserTextEncoding ! -name .DS_Store -name '.*' -maxdepth 1 -delete

osascript -e 'tell application "System Preferences" to quit'
xcode-select -p &>/dev/null || ./setitup/xcodeselect
jabba --version &>/dev/null || ./setitup/jabba
brew --version &>/dev/null || ./setitup/homebrew
rvm -v &>/dev/null || ./setitup/ruby
nvm -v &>/dev/null || ./setitup/node
./install-apps
./setitup/mac
./setitup/zsh
./open-apps

osascript -e 'tell application "iTerm2" to launch'
osascript -e 'tell application  "Terminal" to quit'
